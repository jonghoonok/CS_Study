# DB

데이터베이스 기초부터 심화까지



참고서적

- Do it! 오라클로 배우는 데이터베이스 입문
- Database System Concepts [pdf](https://www.db-book.com/db7/index.html)
  - SNUON 강의 "데이타베이스: 빅데이터 시대의 필수 정보관리 개론" - 이상구
- Softbank 신입사원 OJT



[TOC]

## **1. 데이터베이스 개론**

> 데이터베이스 기본 개념



데이터베이스란?

- 데이터와 정보
  - 데이터: 어떤 필요에 의해 수집했지만 아직 특정 목적을 위해 평가하거나 정제하지 않은 자료
  - 정보: 수집한 데이터를 어떤 목적을 위해 분석하거나 가공한 것
- 효율적인 데이터 관리: **데이터베이스의 필요성** 대두
  - 데이터를 통합하여 관리
  - 일관된 방법을 관리
  - 데이터의 누락, 중복 제거
  - 여러 사용자가 공동으로 실시간 사용 가능
- 데이터베이스
  - 특정 목적을 위해 여러 사람이 공유하여 사용할 수 있으며 효율적 관리와 검색을 위해 **구조화한 데이터 집합**
- 파일 시스템
  - DB등장 이전에 데이터를 관리하던 방식
  - 각각의 응용 프로그램에 필요한 데이터를 각각 저장: 중복 및 누락 발생 가능
    - 데이터의 통합 관리 필요성 대두: **DBMS**의 등장



DBMS란?

- Database Management System
- 여러 목적으로 사용할 데이터의 접근/관리 등 업무를 **DBMS가 전담**함
  - 하나의 DBMS를 통해 관리: 데이터를 관리하는 방식이 통합됨
  - 중복 및 누락 방지: 하나의 소프트웨어가 데이터를 관리
  - 공동으로 실시간 사용 가능: 데이터가 응용프로그램에 독립적이므로 프로그램 업데이트 시에도 사용 가능



데이터 모델

- 데이터를 저장하는 방식을 정의해 놓은 개념 모형

- 계층형 데이터 모델

  - 트리 구조를 활용
  - 부모 자식 관계 - 1:N

- 네트워크형 데이터 모델

  - 그래프 구조를 기반으로 함
  - 자식 개체가 여러 부모 개체를 가질 수 있음 - M:N

- 객체 지향형 데이터 모델

  - 데이터를 독립된 개체로 구성하여 관리

- **관계형 데이터 모델**

  - 데이터 간 관계에 초점

    - 각 데이터의 **독립 특성**만을 규정하여 데이터 묶음을 나눔
    - 중복이 발생할 수 있는 데이터는 별개의 **relation**으로 정의하여 연결

  - 구성 요소

    - | 이름                   | 설명                                   | 대응(구현)되는 개념  |
      | ---------------------- | -------------------------------------- | -------------------- |
      | 개체(entity)           | 데이터화하려는 사물/개념의 정보 단위   | 테이블(**relation**) |
      | 속성(attribute)        | 데이터의 종류, 특성, 상태              | 열(column)           |
      | **관계(relationship)** | 개체 간 또는 속성 간의 연관성을 나타냄 | 외래키               |

  - **릴레이션(relation)과 관계(relationship)의 차이** [링크](https://m.blog.naver.com/PostView.nhn?blogId=ej5811&logNo=80191263951&proxyReferer=https:%2F%2Fwww.google.com%2F)

    - 릴레이션: 집합x와 집합y 사이에 관계 R을 만족하는 모든 순서쌍
      - 테이블이 집합 간의 cartesian product를 생성한다는 것을 생각해보자
      - 집합이론에서는 relation, 논리 데이터 모델링에서는 entity, 관계형 데이터베이스에서는 table
    - 관계: 하나 또는 두 개의 entity type으로부터 **업무적인 이유**에 의해 entity가 연결되어 있는 **페어링의 집합**
      - 예) entity type "주문"의 entity인 "주문번호"가 entity type "주문상품"의 entity인 "상품코드"와 연결되어 페어링을 이루고 있음
      - 페어링은 관계의 멤버이고, 관계는 페어링의 집합체



### 1.1. 관계형 데이터 베이스



관계형 데이터베이스

- 관계형 데이터 모델을 바탕으로 만들어진 데이터베이스
- 관계형 데이터베이스를 관리하는 시스템은 **RDBMS**(Relational Database Management System)이라 함
  - MS-SQL, MySQL, MariaDB, PostgreSQL, DB2 등



SQL

- Structured Query Language
- RDBMS에서 데이터를 다루고 관리하는 데 사용하는 **질의 언어**
  - 조회, 데이터 조작, 객체 조작 등
  - DQL(Data Query Language)
    - 데이터를 원하는 방식으로 조회하는 명령어
  - DML(Data Manipulation Language)
    - 데이터를 저장, 수정, 삭제하는 명령어
  - DDL(Data Definition Language)
    - 테이블을 포함한 여러 객체를 생성, 수정, 삭제하는 명령어
  - TCL(Transaction Control Language)
    - 트랜잭션 데이터의 영구 저장, 취소 등과 관련된 명령어
  - DCL(Data Control Language)
    - 데이터 사용 권한과 관련된 명령어



관계형 데이터베이스의 구성 요소

- 테이블
  - 2차원 표 형태의 데이터 저장 공간
  - 행: 저장하려는 **하나의 개체를 구성하는 여러 값**을 가로로 늘어뜨린 것
  - 열: 저장하려는 데이터를 **대표하는 이름과 공동 특성**
- 키
  - 수많은 데이터를 구별할 수 있는 유일한 값
  - **기본키**
    - 저장된 행을 식별할 수 있는 유일한 값
    - 값이 중복되지 않아야 함
    - NULL값을 가질 수 없음
    - 보통 후보키 중에 **개인 정보 노출이 가장 적은 데이터를 선정함**
  - 보조키
    - 후보키 중에 기본키로 지정되지 않은 값: 속성은 기본키와 같음
  - 외래키
    - 특정 테이블에 포함되어 있으면서 다른 테이블의 기본키로 지정된 키
    - 예) 학생 정보 테이블에 있는 학과 코드: 학과 정보 테이블과 학생 정보 테이블을 이어줌
  - 복합키
    - 여러 열을 조합하여 기본키 역할을 할 수 있게 만든 키
    - 예) 과목 정보 테이블에서 (과목코드+교수+강의시간) 조합으로 수업을 유일하게 식별함 



오라클 데이터베이스

- 대표적인 상용 관계형 데이터베이스 제품
- 자료형
  - 여러 자료형이 있지만 보통 **VARCHAR2, NUMBER, DATE** 세 가지만을 사용함
- 객체
  - 테이블: 데이터를 저장하는 장소
  - 인덱스: 테이블 검색 효율을 높이기 위해 사용
  - 뷰: 데이터를 논리적으로 연결하여 하나의 테이블**처럼** 사용하게 해줌
  - 시퀀스: 일련 번호를 생성해 줌
  - 시노님: 오라클 객체의 **별칭**을 지정함
  - 프로시저: 프로그래밍 연산 및 기능 수행, return 값 없음
  - 함수: 프로그래밍 연산 및 기능 수행, return 값 있음
  - 패키지: 관련 있는 프로시저와 함수를 보관함
  - 트리거: 데이터 관련 작업의 연결 및 방지 관련 기능 제공
- PL/SQL
  - SQL과 별도로 데이터 관리를 위해 만들어진 프로그래밍 언어
  - 프로그래밍 언어에서 제공하는 요소를(변수, 조건문, 반복문) 사용하여 데이터를 관리할 수 있음



## **2. DQL**

> SELECT 문을 이용하여 데이터베이스를 조회, 분석하기



데이터를 조회하는 3가지 방법

- SELECTION
  - **행 단위**로 원하는 데이터를 조회
- PROJECTION
  - **열 단위**로 원하는 데이터를 조회
  - SELECTION, PROJECTION을 함께 사용하여 상세하게 조회할 수도 있음
- JOIN
  - **두 개 이상의 테이블을 연결하여 하나의 테이블처럼 조회**
  - SELECT문을 사용할 때 자주 사용됨



### 2.1. SELECT문의 기본 형식



`SELECT [조회할 열1 이름], [열2], ..., [열N] FROM [조회할 테이블 이름];`

- 조회할 열 이름에 `*`를 넣으면 전체 열 조회 가능: `SELECT * FROM EMP;`
- 띄어쓰기와 줄 바꿈 활용
  - 명령 수행에 영향을 주지 않기 때문에 가독성을 위해 **SELECT와 FROM을 다른 줄에 적는 것 권장**



중복 제거

- DISTINCT를 이용하여 중복을 제거하고 특정 데이터 종류만 확인 가능

- ```SQL
  SELECT DISTINCT DEPTNO
  	FROM EMP;
  ```

- ALL을 이용하면 반대로 중복을 제거하지 않고 그대로 출력함

- ```SQL
  SELECT ALL DEPTNO
  	FROM EMP;
  ```



정렬

- ORDER BY를 사용하여 출력 데이터를 정렬함

- SELECT문의 제일 마지막에 `ORDER BY [정렬하려는 열(여러 개 가능)] [정렬 옵션]` 을 붙여 사용

  - 정렬 옵션은 ASC(기본 값), DESC 존재

  - ```SQL
    SELECT *
    	FROM EMP
    ORDER BY SAL;
    ```

  - 여러 개 조건을 붙이면 먼저 오는 열을 우선 정렬하고 값이 같으면 그 다음 열 기준으로 정렬

    - `ORDER BY DEPTNO DESC, ENAME;`

- 정렬은 느리기 때문에 **가능하면 사용하지 않을 것**을 권장



별칭 설정

- SELECT 절에 명시한 열 이름이 아니라 별칭이(alias) 출력되도록 할 수 있음

  - 편의를 위해 + 해당 열이 어떻게 도출되었는지 노출되지 않기 위해 사용함

- **별칭을 하나씩 지정**하는 방법과 **연산식을 사용**하는 방법 존재

  - 연산식을 사용하여 연수입 출력하기(월급*12 + 상여)

  - ```SQL
    SELECT ENAME, SAL, SAL*12+COMM, COMM
    	FROM EMP;
    ```

  - 별칭을 지정하는 방법

    - 4가지가 있는데 보통 3번째를 많이 사용(한 칸 띄우기, 한 칸 띄우고 큰 따옴표, **한 칸 띄우고 AS**, 한 칸 띄우고 AS 다음에 큰 따옴표 )
    - `SELECT ENAME, SAL, SAL*12+COMM AS ANNSAL, COMM FROM EMP;`
    - SQL문에 따옴표 사용이 좋지 않기 때문: 프로그래밍 언어에서 문자열로 ("SQL") 사용 시 에러 발생



WHERE

- **특정 조건을 기준으로** 원하는 행을 출력

  - WHERE절에는 조건식이 들어감: 조건식이 참인 경우에만 출력

- FROM 다음에 WHERE 절을 이용함

  - ```SQL
    SELECT *
    	FROM EMP
    WHERE DEPTNO = 30;
    ```

  -  SQL문에서는 동등 연산자가 ==가 아니라 =임

- WHERE문과 함께 사용하는 연산자

  - **논리 연산자 AND, OR**을 이용하여 **여러 개의 조건식 적용도 가능**: 조건식 갯수는 무제한

    - 여러 개 조건식이 묶여 있을 때 NOT을 이용하여 한번에 뒤집는 경우 많음

  - **IN**을 이용하여 조건식 갯수를 줄일 수 있음

    - OR을 여러 개 사용한 경우

    - ```SQL
      SELECT *
      	FROM EMP
      WHERE JOB = 'MANAGER'
         OR JOB = 'SALESMAN'
         OR JOB = 'CLERK';
      ```

    - IN을 사용한 경우

    - ```SQL
      SELECT *
      	FROM EMP
      WHERE JOB IN ('MANAGER', 'SALESMAN', 'CLERK');
      ```

  - **BETWEEN A AND B**를 이용하여 조회하기

    - ```SQL
      SELECT *
      	FROM EMP
      WHERE SAL BETWEEN 2000 AND 3000;
      ```

  - 일부 문자열이 포함된 데이터를 조회할 때 사용하는 **LIKE**

    - ENAME 열 값이 대문자 S로 시작하는 데이터를 조회하라는 SQL문

    - ```SQL
      SELECT *
      	FROM EMP
      WHERE ENAME LIKE 'S%';
      ```

    - 와일드 카드: ( `%, _` ) 특정 문자 또는 문자열을 대체함

  - **IS NULL**을 이용해 데이터가 NULL인 행을 조회하기

    - ```SQL
      SELECT *
      	FROM EMP
      WHERE COMM IS NULL;
      ```

    - NULL은 비교 연산자로 비교하면 결과 값도 NULL이 되기 때문에 IS NULL을 이용해야 함

  - **집합 연산자**

    - 두 개 이상의 SELECT문의 결과 값을 연결함
    - 열 갯수와 각각의 열의 자료형이 일치해야(열 이름은 달라도 ok)연결 가능
    - UNION: 합집합으로 묶음, 중복 제거
    - UNION ALL: 합집합으로 묶고 중복 제거하지 않음
    - MINUS: 차집합 - 먼저 작성한 SELECT문의 결과에서 다음 결과를 빼 줌
    - INTERSECT: 교집합



## **3. DML, DDL**





## **4. DL/SQL**



## 5. DB 실무

실제로 서비스 개발에서 어떤 식으로 DB를 다루는지 OJT에서 배운 내용을 바탕으로 작성



### 5.1. JDBC

> DBMS 종류에 상관없이 DB를 조작할 수 있기 위해 사용하는 API



코딩의 흐름

JDBC 드라이버 로드 > DB 연결 > DB 조작(SQL) > DB 연결 종료



JDBC 드라이버 로드 [공식문서](https://jdbc.postgresql.org/documentation/81/connect.html)

- JDBC 드라이버란?
  - 각 DBMS에 맞는 클라이언트
  - DBMS 별 드라이버가 필요함(`.jar` 파일)
    - JDBC가 실제로 하는 일은 없고(API니까...) 드라이버가 일을 함
- `Class.forName("JDBC Name");` 으로 로딩함 
  - 드라이버의 클래스를 객체화하여 로드
- 드라이버 매니저를 통해 연결 객체 획득
  - `Connection con = DriverManager.getConnection(...);` 
- 실행 도구 생성
  - `Statement st = con.createStatement();`
- 결과 실행
  - `ResultSet rs = st.executeQuery(sql);`





